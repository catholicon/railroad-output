<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2018-02-04 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20180204" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Jackrabbit Oak &#x2013; Backward compatibility</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarEnabled">
                  <a href="https://github.com/apache/jackrabbit-oak">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
      <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
<a class="brand" href="./"  title="Oak logo"><img src="oak_logo.png" alt="Oak logo" />
</a>
            <ul class="nav">
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="index.html" title="Jackrabbit Oak">Jackrabbit Oak</a></li>
            <li><a href="license.html" title="License">License</a></li>
            <li><a href="downloads.html" title="Downloads">Downloads</a></li>
            <li><a href="articles.html" title="Articles">Articles</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Concepts and Architecture <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="architecture/overview.html" title="Overview">Overview</a></li>
            <li><a href="architecture/nodestate.html" title="The Node State Model">The Node State Model</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Main APIs <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="http://www.day.com/specs/jcr/2.0/index.html" title="JCR API">JCR API</a></li>
            <li><a href="oak_api/overview.html" title="Oak API">Oak API</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Features and Plugins <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="nodestore/overview.html" title="Node Storage">Node Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="nodestore/documentmk.html" title="Document NodeStore">Document NodeStore</a></li>
                  <li><a href="nodestore/segment/overview.html" title="Segment NodeStore">Segment NodeStore</a></li>
                  <li><a href="nodestore/compositens.html" title="Composite NodeStore">Composite NodeStore</a></li>
              </ul>
            </li>
            <li><a href="plugins/blobstore.html" title="Blob Storage">Blob Storage</a></li>
            <li class="dropdown-submenu">
<a href="query/query.html" title="Query">Query</a>
              <ul class="dropdown-menu">
                  <li><a href="query/query-engine.html" title="Query Engine">Query Engine</a></li>
                  <li><a href="query/grammar-xpath.html" title="XPath Grammar">XPath Grammar</a></li>
                  <li><a href="query/grammar-sql2.html" title="SQL-2 Grammar">SQL-2 Grammar</a></li>
                  <li><a href="query/query-troubleshooting.html" title="Troubleshooting">Troubleshooting</a></li>
                  <li><a href="query/indexing.html" title="Indexing">Indexing</a></li>
                  <li><a href="query/lucene.html" title="Lucene Index">Lucene Index</a></li>
                  <li><a href="query/property-index.html" title="Property Index">Property Index</a></li>
                  <li><a href="query/solr.html" title="Solr Index">Solr Index</a></li>
              </ul>
            </li>
            <li><a href="security/overview.html" title="Security">Security</a></li>
            <li><a href="features/atomic-counter.html" title="Atomic Counter">Atomic Counter</a></li>
            <li><a href="features/observation.html" title="Observation">Observation</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Using Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="use_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="construct.html" title="Repository Construction">Repository Construction</a></li>
            <li><a href="osgi_config.html" title="Configuring Oak">Configuring Oak</a></li>
            <li><a href="command_line.html" title="Command Line Tools">Command Line Tools</a></li>
            <li><a href="migration.html" title="Migration">Migration</a></li>
            <li><a href="differences.html" title="Differences to Jackrabbit 2">Differences to Jackrabbit 2</a></li>
            <li><a href="known_issues.html" title="Known Issues">Known Issues</a></li>
            <li><a href="constraints.html" title="Constraints">Constraints</a></li>
            <li><a href="dos_and_donts.html" title="Dos and Don'ts">Dos and Don'ts</a></li>
            <li><a href="coldstandby/coldstandby.html" title="Cold Standby">Cold Standby</a></li>
            <li><a href="FAQ.html" title="FAQ">FAQ</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developing Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="dev_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="participating.html" title="Participating">Participating</a></li>
            <li><a href="developing-with-git.html" title="Developing with Git">Developing with Git</a></li>
            <li><a href="diagnostic-builds.html" title="Cutting diagnostic builds">Cutting diagnostic builds</a></li>
            <li><a href="branching.html" title="Branching off a new stable">Branching off a new stable</a></li>
            <li><a href="attribution.html" title="Attribution">Attribution</a></li>
            <li><a href="release-schedule.html" title="Release Schedule">Release Schedule</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Links <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="http://jackrabbit.apache.org/oak" title="Apache Jackrabbit Oak">Apache Jackrabbit Oak</a></li>
            <li><a href="http://jackrabbit.apache.org/" title="Apache Jackrabbit">Apache Jackrabbit</a></li>
        </ul>
      </li>
              </ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Oak Documentation</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2018-02-04<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.10-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Jackrabbit Oak"><span class="none"></span>Jackrabbit Oak</a>  </li>
    <li><a href="license.html" title="License"><span class="none"></span>License</a>  </li>
    <li><a href="downloads.html" title="Downloads"><span class="none"></span>Downloads</a>  </li>
    <li><a href="articles.html" title="Articles"><span class="none"></span>Articles</a>  </li>
          <li class="nav-header">Concepts and Architecture</li>
    <li><a href="architecture/overview.html" title="Overview"><span class="none"></span>Overview</a>  </li>
    <li><a href="architecture/nodestate.html" title="The Node State Model"><span class="none"></span>The Node State Model</a>  </li>
          <li class="nav-header">Main APIs</li>
    <li><a href="http://www.day.com/specs/jcr/2.0/index.html" class="externalLink" title="JCR API"><span class="none"></span>JCR API</a>  </li>
    <li><a href="oak_api/overview.html" title="Oak API"><span class="none"></span>Oak API</a>  </li>
          <li class="nav-header">Features and Plugins</li>
    <li><a href="nodestore/overview.html" title="Node Storage"><span class="icon-chevron-down"></span>Node Storage</a>
      <ul class="nav nav-list">
    <li><a href="nodestore/documentmk.html" title="Document NodeStore"><span class="icon-chevron-down"></span>Document NodeStore</a>
      <ul class="nav nav-list">
    <li><a href="nodestore/document/node-bundling.html" title="Node Bundling"><span class="none"></span>Node Bundling</a>  </li>
    <li><a href="nodestore/document/secondary-store.html" title="Secondary Store"><span class="none"></span>Secondary Store</a>  </li>
    <li><a href="nodestore/persistent-cache.html" title="Persistent Cache"><span class="none"></span>Persistent Cache</a>  </li>
    <li><a href="clustering.html" title="Clustering"><span class="none"></span>Clustering</a>  </li>
      </ul>
  </li>
    <li><a href="nodestore/segment/overview.html" title="Segment NodeStore"><span class="none"></span>Segment NodeStore</a>  </li>
    <li><a href="nodestore/compositens.html" title="Composite NodeStore"><span class="none"></span>Composite NodeStore</a>  </li>
      </ul>
  </li>
    <li><a href="plugins/blobstore.html" title="Blob Storage"><span class="none"></span>Blob Storage</a>  </li>
    <li><a href="query/query.html" title="Query"><span class="icon-chevron-down"></span>Query</a>
      <ul class="nav nav-list">
    <li><a href="query/query-engine.html" title="Query Engine"><span class="none"></span>Query Engine</a>  </li>
    <li><a href="query/grammar-xpath.html" title="XPath Grammar"><span class="none"></span>XPath Grammar</a>  </li>
    <li><a href="query/grammar-sql2.html" title="SQL-2 Grammar"><span class="none"></span>SQL-2 Grammar</a>  </li>
    <li><a href="query/query-troubleshooting.html" title="Troubleshooting"><span class="none"></span>Troubleshooting</a>  </li>
    <li><a href="query/indexing.html" title="Indexing"><span class="none"></span>Indexing</a>  </li>
    <li><a href="query/lucene.html" title="Lucene Index"><span class="none"></span>Lucene Index</a>  </li>
    <li><a href="query/property-index.html" title="Property Index"><span class="none"></span>Property Index</a>  </li>
    <li><a href="query/solr.html" title="Solr Index"><span class="none"></span>Solr Index</a>  </li>
      </ul>
  </li>
    <li><a href="security/overview.html" title="Security"><span class="none"></span>Security</a>  </li>
    <li><a href="features/atomic-counter.html" title="Atomic Counter"><span class="none"></span>Atomic Counter</a>  </li>
    <li><a href="features/observation.html" title="Observation"><span class="none"></span>Observation</a>  </li>
          <li class="nav-header">Using Oak</li>
    <li><a href="use_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a>  </li>
    <li><a href="construct.html" title="Repository Construction"><span class="none"></span>Repository Construction</a>  </li>
    <li><a href="osgi_config.html" title="Configuring Oak"><span class="none"></span>Configuring Oak</a>  </li>
    <li><a href="command_line.html" title="Command Line Tools"><span class="none"></span>Command Line Tools</a>  </li>
    <li><a href="migration.html" title="Migration"><span class="none"></span>Migration</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>Differences to Jackrabbit 2</a>
  </li>
    <li><a href="known_issues.html" title="Known Issues"><span class="none"></span>Known Issues</a>  </li>
    <li><a href="constraints.html" title="Constraints"><span class="none"></span>Constraints</a>  </li>
    <li><a href="dos_and_donts.html" title="Dos and Don'ts"><span class="none"></span>Dos and Don'ts</a>  </li>
    <li><a href="coldstandby/coldstandby.html" title="Cold Standby"><span class="none"></span>Cold Standby</a>  </li>
    <li><a href="FAQ.html" title="FAQ"><span class="none"></span>FAQ</a>  </li>
          <li class="nav-header">Developing Oak</li>
    <li><a href="dev_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a>  </li>
    <li><a href="participating.html" title="Participating"><span class="none"></span>Participating</a>  </li>
    <li><a href="developing-with-git.html" title="Developing with Git"><span class="none"></span>Developing with Git</a>  </li>
    <li><a href="diagnostic-builds.html" title="Cutting diagnostic builds"><span class="none"></span>Cutting diagnostic builds</a>  </li>
    <li><a href="branching.html" title="Branching off a new stable"><span class="none"></span>Branching off a new stable</a>  </li>
    <li><a href="attribution.html" title="Attribution"><span class="none"></span>Attribution</a>  </li>
    <li><a href="release-schedule.html" title="Release Schedule"><span class="none"></span>Release Schedule</a>  </li>
          <li class="nav-header">Links</li>
    <li><a href="http://jackrabbit.apache.org/oak" class="externalLink" title="Apache Jackrabbit Oak"><span class="none"></span>Apache Jackrabbit Oak</a>  </li>
    <li><a href="http://jackrabbit.apache.org/" class="externalLink" title="Apache Jackrabbit"><span class="none"></span>Apache Jackrabbit</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
          <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
        <div class="g-plusone" data-href="http://jackrabbit.apache.org/oak/docs/" data-size="tall" ></div>
                  <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
  --><h1>Backward compatibility</h1>
<p>Oak implements the JCR API and we expect most applications to work out of the box. However, the Oak code base is very young and not yet on par with Jackrabbit 2. Some of the more obscure parts of JCR are not (yet) implemented. If you encounter a problem running your application on Oak, please cross check against Jackrabbit 2 before reporting an issue against Oak.</p>
<h1>Reporting issues</h1>
<p>If you encounter a problem where functionality is missing or Oak does not behave as expected please check whether this is a <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-14">known change in behaviour</a> or a <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK">known issue</a>. If in doubt ask on the <a class="externalLink" href="http://oak.markmail.org/">Oak dev list</a>. Otherwise create a <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK">new issue</a>.</p>
<h1>Notable changes</h1>
<p>This section gives a brief overview of the most notable changes in Oak with respect to Jackrabbit 2. These changes are generally caused by overall design decisions carefully considering the benefits versus the potential backward compatibility issues.</p>
<div class="section">
<h2><a name="Session_state_and_refresh_behaviour"></a>Session state and refresh behaviour</h2>
<p>In Jackrabbit 2 sessions always reflects the latest state of the repository. With Oak a session reflects a stable view of the repository from the time the session was acquired (<a class="externalLink" href="http://en.wikipedia.org/wiki/MVCC">MVCC model</a>). This is a fundamental design aspect for achieving the distributed nature of an Oak repository. A rarely encountered side effect of this is that sessions expose <a href="architecture/transactional-model.html">write skew</a>.</p>
<p>This change can cause subtle differences in behavior when two sessions perform modifications relying on one session seeing the other session&#x2019;s changes. Oak requires explicit calls to <tt>Session.refresh()</tt>in this case.</p>

<blockquote>
<p><i>Note</i>: To ease migration to Oak, sessions being idle for more than one minute will log a warning to the log file. Furthermore sessions are automatically synchronised to reflect the same state across accesses within a single thread. That is, an older session will see the changes done through a newer session given both sessions are accessed from within the same thread.</p>
<p>Automatic session synchronisation is a transient feature and will most probably be removed in future versions of Oak. See <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-803">OAK-803</a> for further details regarding session backwards compatibility and <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-960">OAK-960</a> regarding in thread session synchronisation.</p>
<p>The <tt>SessionMBean</tt> provides further information on when a session is refreshed and wheter a refresh will happen on the next access. </p>
</blockquote>
<p>On Oak <tt>Item.refresh()</tt> is deprecated and will always cause an <tt>Session.refresh()</tt>. The former call will result in a warning written to the log in order to facilitate locating trouble spots.</p>
<p>On Oak <tt>Item.save()</tt> is deprecated and will per default log a warning and fall back to <tt>Session.save()</tt>. This behaviour can be tweaked with <tt>-Ditem-save-does-session-save=false</tt> in which case no fall back to <tt>Session#save()</tt> will happen but an <tt>UnsupportedRepositoryException</tt> is thrown if the sub-tree rooted at the respective item does not contain all transient changes. See <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-993">OAK-993</a> for details.</p></div>
<div class="section">
<h2><a name="Query"></a>Query</h2>
<p>Oak does not index as much content by default as does Jackrabbit 2. You need to create custom indexes when necessary, much like in traditional RDBMSs. If there is no index for a specific query then the repository will be traversed. That is, the query will still work but probably be very slow. See the <a href="query/query.html">query overview page</a> for how to create a custom index.</p>
<p>There were some smaller bugfixes in the query parser which might lead to incompatibility. See the <a href="query/query.html">query overview page</a> for details.</p>
<p>In Oak, the method <tt>QueryManager.createQuery</tt> does not return an object of type <tt>QueryObjectModel</tt>.</p></div>
<div class="section">
<h2><a name="Observation"></a>Observation</h2>

<ul>
  
<li>
<p><tt>Event.getInfo()</tt> contains the primary and mixin node types of the associated parent node of the  event. The key <tt>jcr:primaryType</tt> maps to the primary type and the key <tt>jcr:mixinTypes</tt> maps to an  array containing the mixin types.</p></li>
  
<li>
<p><tt>Event.getUserId()</tt>, <tt>Event.getUserData()</tt>and <tt>Event.getDate()</tt> will only be available for locally  generated events (i.e. on the same cluster node). To help identifying potential trouble spots,  calling any of these methods without a previous call to <tt>JackrabbitEvent#isExternal()</tt> will write  a warning to the log file.</p></li>
  
<li>
<p>Push notification mechanisms like JCR observation weight heavy on distributed systems. Therefore,  if an application requirement is not actually an &#x201c;eventing problem&#x201d; consider using different means  like query and custom indexes.  <a class="externalLink" href="http://sling.apache.org">Apache Sling</a> identified and classified common <a class="externalLink" href="https://cwiki.apache.org/confluence/display/SLING/Observation+usage+patterns">usage patterns</a> of observation and  recommendations on alternative solutions where applicable.</p></li>
  
<li>
<p>Event generation is done by looking at the difference between two revisions of the persisted  content trees. Items not present in a previous revision but present in the current revision are  reported as <tt>Event.NODE_ADDED</tt> and <tt>Event.PROPERTY_ADDED</tt>, respectively. Items present in a  previous revision but not present in the current revision are reported as <tt>Event.NODE_REMOVED</tt> and  <tt>Event.PROPERTY_REMOVED</tt>, respectively. Properties that changed in between the previous revision  and the current revision are reported as <tt>PROPERTY_CHANGED</tt>. As a consequence operations that  cancelled each others in between the previous revision and the current revision are not reported.  Furthermore the order of the events depends on the underlying implementation and is not specified.  In particular there are some interesting consequences:</p>
  
<ul>
    
<li>Touched properties: Jackrabbit 2 used to generate a <tt>PROPERTY_CHANGED</tt> event when touching a  property (i.e. setting a property to its current value). Oak keeps closer to the specification  and <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-948">omits such events</a>. More generally removing  a subtree and replacing it with the same subtree will not generate any event.</li>
  </ul>
  
<ul>
    
<li>Removing a referenceable node and adding it again will result in a <tt>PROPERTY_CHANGED</tt> event for  <tt>jcr:uuid</tt>; the same applies for other built-in protected and mandatory properties  such as e.g. jcr:versionHistory if the corresponding versionable node  was removed and a versionable node with the same name is being created.</li>
  </ul>
  
<ul>
    
<li>Limited support for <tt>Event.NODE_MOVED</tt>:</li>
  </ul>
  
<ul>
    
<li>A node that is added and subsequently moved will not generate a <tt>Event.NODE_MOVED</tt> but a <tt>Event.NODE_ADDED</tt> for its final location.</li>
  </ul>
  
<ul>
    
<li>A node that is moved and subsequently removed will not generate a <tt>Event.NODE_MOVED</tt> but a <tt>Event.NODE_REMOVED</tt> for its initial location.</li>
  </ul>
  
<ul>
    
<li>A node that is moved and subsequently moved again will only generate a single <tt>Event.NODE_MOVED</tt> reporting its initial location as <tt>srcAbsPath</tt> and its  final location as <tt>destAbsPath</tt>.</li>
  </ul>
  
<ul>
    
<li>A node whose parent was moved and that moved itself subsequently reports its initial location as <tt>srcAbsPath</tt> instead of the location it had under the moved parent.</li>
  </ul>
  
<ul>
    
<li>A node that was moved and subsequently its parent is moved will report its final location as <tt>destAbsPath</tt> instead of the location it had before its parent moved.</li>
  </ul>
  
<ul>
    
<li>Removing a node and adding a node with the same name at the same parent will be reported as <tt>NODE_MOVED</tt> event as if it where caused by <tt>Node.orderBefore()</tt> if the parent node is orderable and the sequence of operations caused a change in the order of the child nodes.</li>
  </ul>
  
<ul>
    
<li>The exact sequence of <tt>Node.orderBefore()</tt> will not be reflected through <tt>NODE_MOVED</tt> events: given two child nodes <tt>a</tt> and <tt>b</tt>, ordering <tt>a</tt> after <tt>b</tt> may be reported as ordering <tt>b</tt> before <tt>a</tt>.</li>
  </ul></li>
  
<li>
<p>The sequence of differences Oak generates observation events from is guaranteed to contain the  before and after states of all cluster local changes. This guarantee does not hold for cluster  external changes. That is, cancelling operations from cluster external events might not be  reported event though they stem from separate commits (<tt>Session.save()</tt>).</p></li>
  
<li>
<p>Unregistering an observation listener blocks for no more than one second. If a pending  <tt>onEvent()</tt> call does not complete by then a warning is logged and the listener will be  unregistered without further waiting for the pending <tt>onEvent()</tt> call to complete.  See <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-1290">OAK-1290</a> and  <a class="externalLink" href="https://java.net/jira/browse/JSR_333-74">JSR_333-74</a> for further information.</p></li>
  
<li>
<p>See <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-1459">OAK-1459</a> introduced some differences  in what events are dispatch for bulk operations (moving and deleting sub-trees):</p></li>
</ul>

<table border="0" class="table table-striped">

<tr class="a">

<th>Operation</th>

<th>Jackrabbit 2</th>

<th>Oak</th>
</tr>

<tr class="b">

<td>add sub-tree</td>

<td>NODE_ADDED event for every node in the sub-tree</td>

<td>NODE_ADDED event for every node in the sub-tree</td>
</tr>

<tr class="a">

<td>remove sub-tree</td>

<td>NODE_REMOVED event for every node in the sub-tree</td>

<td>NODE_REMOVED event for the root of the sub-tree only</td>
</tr>

<tr class="b">

<td>move sub-tree</td>

<td>NODE_MOVED event, NODE_ADDED event for the root of the sub-tree only,
    NODE_REMOVED event for every node in the sub-tree</td>

<td>NODE_MOVED event, NODE_ADDED event for the root of the sub-tree only,
    NODE_REMOVED event for the root of the sub-tree only</td>
</tr>
</table></div>
<div class="section">
<h2><a name="Binary_streams"></a>Binary streams</h2>
<p>In Jackrabbit 2 binary values were often (though not always) stored in or spooled into a file in the local file system, and methods like <tt>Value.getStream()</tt> would thus be backed by <tt>FileInputStream</tt> instances. As a result the <tt>available()</tt> method of the stream would typically return the full count of remaining bytes, regardless of whether the next <tt>read()</tt> call would block to wait for disk IO.</p>
<p>In Oak binaries are typically stored in an external database or (in case of the SegmentNodeStore) using a custom data structure in the local file system. The streams returned by Oak are therefore custom <tt>InputStream</tt> subclasses that implement the <tt>available()</tt> method based on whether the next <tt>read()</tt> call will return immediately or if it needs to block to wait for the underlying IO operations.</p>
<p>This difference may affect some clients that make the incorrect assumption that the <tt>available()</tt> method will always return the number of remaining bytes in the stream, or that the return value is zero only at the end of the stream. Neither assumption is correctly based on the <tt>InputStream</tt> API contract, so such client code needs to be fixed to avoid problems with Oak.</p></div>
<div class="section">
<h2><a name="Locking"></a>Locking</h2>
<p>Oak does not support the strict locking semantics of Jackrabbit 2.x. Instead a &#x201c;fuzzy locking&#x201d; approach is used with lock information stored as normal content changes. If a <tt>mix:lockable</tt> node is marked as holding a lock, then the code treats it as locked, regardless of what other concurrent sessions that might see different versions of the node see or do. Similarly a lock token is simply the path of the locked node.</p>
<p>This fuzzy locking should not be used or relied as a tool for synchronizing the actions of two clients that are expected to access the repository within a few seconds of each other. Instead this feature is mostly useful as a higher level tool, for example a human author could use a lock to mark a document as locked for a few hours or days during which other users will not be able to modify the document.</p></div>
<div class="section">
<h2><a name="Same_name_siblings"></a>Same name siblings</h2>
<p>Same name siblings (SNS) are deprecated in Oak. We figured that the actual benefit supporting same name siblings as mandated by JCR is dwarfed by the additional implementation complexity. Instead there are ideas to implement a feature for automatic <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-129">disambiguation of node names</a>.</p>
<p>In the meanwhile we have <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-203">basic support</a> for same name siblings but that might not cover all cases.</p></div>
<div class="section">
<h2><a name="XML_Import"></a>XML Import</h2>
<p>The import behavior for <a class="externalLink" href="http://www.day.com/maven/jsr170/javadocs/jcr-2.0/javax/jcr/ImportUUIDBehavior.html#IMPORT_UUID_CREATE_NEW"><tt>IMPORT_UUID_CREATE_NEW</tt></a> in Oak is implemented slightly different compared to Jackrabbit. Jackrabbit 2.x only creates a new UUID when it detects an existing conflicting node with the same UUID. Oak always creates a new UUID, even if there is no conflicting node. The are mainly two reasons why this is done in Oak:</p>

<ul>
  
<li>The implementation in Oak is closer to what the JCR specification says: <i>Incoming nodes are assigned newly created identifiers upon addition to the workspace. As a result, identifier collisions never occur.</i></li>
  
<li>Oak uses a MVCC model where a session operates on a snapshot of the repository. It is therefore very difficult to ensure new UUIDs only in case of a conflict. Based on the snapshot view of a session, an existing node with a conflicting UUID may not be visible until commit.</li>
</ul></div>
<div class="section">
<h2><a name="Identifiers"></a>Identifiers</h2>
<p>In contrast to Jackrabbit 2.x, only referenceable nodes in Oak have a UUID assigned. With Jackrabbit 2.x the UUID is only visible in content when the node is referenceable and exposes the UUID as a <tt>jcr:uuid</tt> property. But using <tt>Node.getIdentifier()</tt>, it is possible to get the UUID of any node. With Oak this method will only return a UUID when the node is referenceable, otherwise the identifier is the UUID of the nearest referenceable ancestor with the relative path to the node.</p>
<p>Manually adding a property with the name <tt>jcr:uuid</tt> to a non referenceable node might have unexpected effects as Oak maintains an unique index on <tt>jcr:uuid</tt> properties. As the namespace <tt>jcr</tt> is reserved, doing so is strongly discouraged.</p></div>
<div class="section">
<h2><a name="Versioning"></a>Versioning</h2>

<ul>
  
<li>
<p>Because of the different identifier implementation in Oak, the value of a <tt>jcr:frozenUuid</tt> property on a frozen node will not always be a UUID (see also section about Identifiers). The property reflects the value returned by <tt>Node.getIdentifier()</tt> when a node is copied into the version storage as a frozen node. This also means a node restored from a frozen node will only have a <tt>jcr:uuid</tt> when it is actually referenceable.</p></li>
  
<li>
<p>Oak does currently not implement activities (<tt>OPTION_ACTIVITIES_SUPPORTED</tt>), configurations and baselines (<tt>OPTION_BASELINES_SUPPORTED</tt>).</p></li>
  
<li>
<p>Oak does currently not implement the various variants of <tt>VersionManager.merge</tt> but throws an <tt>UnsupportedRepositoryOperationException</tt> if such a method is called.</p></li>
</ul></div>
<div class="section">
<h2><a name="Security"></a>Security</h2>

<ul>
  
<li><a href="security/authentication/differences.html">Authentication</a></li>
  
<li><a href="security/accesscontrol/differences.html">Access Control Management</a></li>
  
<li><a href="security/permission/differences.html">Permission Evaluation</a></li>
  
<li><a href="security/privilege/differences.html">Privilege Management</a></li>
  
<li><a href="security/principal/differences.html">Principal Management</a></li>
  
<li><a href="security/user/differences.html">User Management</a></li>
</ul></div>
<div class="section">
<h2><a name="Workspaces"></a>Workspaces</h2>
<p>An Oak repository only has one default workspace.</p></div>
<div class="section">
<h2><a name="Node_Name_Length_Limit"></a>Node Name Length Limit</h2>
<p>With the document storage backend (MongoDB, RDBMS), there is currently a limit of 150 UTF-8 bytes on the length of the node names. See also OAK-2644.</p></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2012&#x2013;2018
<a href="https://www.apache.org/">The Apache Software Foundation</a>.
All rights reserved.</p>
        </div>
                          <div id="ohloh" class="pull-right">
      <script type="text/javascript" src="https://www.ohloh.net/p/jackrabbit-oak/widgets/project_thin_badge.js"></script>
    </div>
        </div>
    </footer>
    </body>
</html>
