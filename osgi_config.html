<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2018-02-04 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20180204" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Jackrabbit Oak &#x2013; Repository OSGi Configuration</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarEnabled">
                  <a href="https://github.com/apache/jackrabbit-oak">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
      <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
<a class="brand" href="./"  title="Oak logo"><img src="oak_logo.png" alt="Oak logo" />
</a>
            <ul class="nav">
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="index.html" title="Jackrabbit Oak">Jackrabbit Oak</a></li>
            <li><a href="license.html" title="License">License</a></li>
            <li><a href="downloads.html" title="Downloads">Downloads</a></li>
            <li><a href="articles.html" title="Articles">Articles</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Concepts and Architecture <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="architecture/overview.html" title="Overview">Overview</a></li>
            <li><a href="architecture/nodestate.html" title="The Node State Model">The Node State Model</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Main APIs <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="http://www.day.com/specs/jcr/2.0/index.html" title="JCR API">JCR API</a></li>
            <li><a href="oak_api/overview.html" title="Oak API">Oak API</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Features and Plugins <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="nodestore/overview.html" title="Node Storage">Node Storage</a>
              <ul class="dropdown-menu">
                  <li><a href="nodestore/documentmk.html" title="Document NodeStore">Document NodeStore</a></li>
                  <li><a href="nodestore/segment/overview.html" title="Segment NodeStore">Segment NodeStore</a></li>
                  <li><a href="nodestore/compositens.html" title="Composite NodeStore">Composite NodeStore</a></li>
              </ul>
            </li>
            <li><a href="plugins/blobstore.html" title="Blob Storage">Blob Storage</a></li>
            <li class="dropdown-submenu">
<a href="query/query.html" title="Query">Query</a>
              <ul class="dropdown-menu">
                  <li><a href="query/query-engine.html" title="Query Engine">Query Engine</a></li>
                  <li><a href="query/grammar-xpath.html" title="XPath Grammar">XPath Grammar</a></li>
                  <li><a href="query/grammar-sql2.html" title="SQL-2 Grammar">SQL-2 Grammar</a></li>
                  <li><a href="query/query-troubleshooting.html" title="Troubleshooting">Troubleshooting</a></li>
                  <li><a href="query/indexing.html" title="Indexing">Indexing</a></li>
                  <li><a href="query/lucene.html" title="Lucene Index">Lucene Index</a></li>
                  <li><a href="query/property-index.html" title="Property Index">Property Index</a></li>
                  <li><a href="query/solr.html" title="Solr Index">Solr Index</a></li>
              </ul>
            </li>
            <li><a href="security/overview.html" title="Security">Security</a></li>
            <li><a href="features/atomic-counter.html" title="Atomic Counter">Atomic Counter</a></li>
            <li><a href="features/observation.html" title="Observation">Observation</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Using Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="use_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="construct.html" title="Repository Construction">Repository Construction</a></li>
            <li><a href="osgi_config.html" title="Configuring Oak">Configuring Oak</a></li>
            <li><a href="command_line.html" title="Command Line Tools">Command Line Tools</a></li>
            <li><a href="migration.html" title="Migration">Migration</a></li>
            <li><a href="differences.html" title="Differences to Jackrabbit 2">Differences to Jackrabbit 2</a></li>
            <li><a href="known_issues.html" title="Known Issues">Known Issues</a></li>
            <li><a href="constraints.html" title="Constraints">Constraints</a></li>
            <li><a href="dos_and_donts.html" title="Dos and Don'ts">Dos and Don'ts</a></li>
            <li><a href="coldstandby/coldstandby.html" title="Cold Standby">Cold Standby</a></li>
            <li><a href="FAQ.html" title="FAQ">FAQ</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developing Oak <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="dev_getting_started.html" title="Getting Started">Getting Started</a></li>
            <li><a href="participating.html" title="Participating">Participating</a></li>
            <li><a href="developing-with-git.html" title="Developing with Git">Developing with Git</a></li>
            <li><a href="diagnostic-builds.html" title="Cutting diagnostic builds">Cutting diagnostic builds</a></li>
            <li><a href="branching.html" title="Branching off a new stable">Branching off a new stable</a></li>
            <li><a href="attribution.html" title="Attribution">Attribution</a></li>
            <li><a href="release-schedule.html" title="Release Schedule">Release Schedule</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Links <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="http://jackrabbit.apache.org/oak" title="Apache Jackrabbit Oak">Apache Jackrabbit Oak</a></li>
            <li><a href="http://jackrabbit.apache.org/" title="Apache Jackrabbit">Apache Jackrabbit</a></li>
        </ul>
      </li>
              </ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Oak Documentation</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2018-02-04<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.10-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Jackrabbit Oak"><span class="none"></span>Jackrabbit Oak</a>  </li>
    <li><a href="license.html" title="License"><span class="none"></span>License</a>  </li>
    <li><a href="downloads.html" title="Downloads"><span class="none"></span>Downloads</a>  </li>
    <li><a href="articles.html" title="Articles"><span class="none"></span>Articles</a>  </li>
          <li class="nav-header">Concepts and Architecture</li>
    <li><a href="architecture/overview.html" title="Overview"><span class="none"></span>Overview</a>  </li>
    <li><a href="architecture/nodestate.html" title="The Node State Model"><span class="none"></span>The Node State Model</a>  </li>
          <li class="nav-header">Main APIs</li>
    <li><a href="http://www.day.com/specs/jcr/2.0/index.html" class="externalLink" title="JCR API"><span class="none"></span>JCR API</a>  </li>
    <li><a href="oak_api/overview.html" title="Oak API"><span class="none"></span>Oak API</a>  </li>
          <li class="nav-header">Features and Plugins</li>
    <li><a href="nodestore/overview.html" title="Node Storage"><span class="icon-chevron-down"></span>Node Storage</a>
      <ul class="nav nav-list">
    <li><a href="nodestore/documentmk.html" title="Document NodeStore"><span class="icon-chevron-down"></span>Document NodeStore</a>
      <ul class="nav nav-list">
    <li><a href="nodestore/document/node-bundling.html" title="Node Bundling"><span class="none"></span>Node Bundling</a>  </li>
    <li><a href="nodestore/document/secondary-store.html" title="Secondary Store"><span class="none"></span>Secondary Store</a>  </li>
    <li><a href="nodestore/persistent-cache.html" title="Persistent Cache"><span class="none"></span>Persistent Cache</a>  </li>
    <li><a href="clustering.html" title="Clustering"><span class="none"></span>Clustering</a>  </li>
      </ul>
  </li>
    <li><a href="nodestore/segment/overview.html" title="Segment NodeStore"><span class="none"></span>Segment NodeStore</a>  </li>
    <li><a href="nodestore/compositens.html" title="Composite NodeStore"><span class="none"></span>Composite NodeStore</a>  </li>
      </ul>
  </li>
    <li><a href="plugins/blobstore.html" title="Blob Storage"><span class="none"></span>Blob Storage</a>  </li>
    <li><a href="query/query.html" title="Query"><span class="icon-chevron-down"></span>Query</a>
      <ul class="nav nav-list">
    <li><a href="query/query-engine.html" title="Query Engine"><span class="none"></span>Query Engine</a>  </li>
    <li><a href="query/grammar-xpath.html" title="XPath Grammar"><span class="none"></span>XPath Grammar</a>  </li>
    <li><a href="query/grammar-sql2.html" title="SQL-2 Grammar"><span class="none"></span>SQL-2 Grammar</a>  </li>
    <li><a href="query/query-troubleshooting.html" title="Troubleshooting"><span class="none"></span>Troubleshooting</a>  </li>
    <li><a href="query/indexing.html" title="Indexing"><span class="none"></span>Indexing</a>  </li>
    <li><a href="query/lucene.html" title="Lucene Index"><span class="none"></span>Lucene Index</a>  </li>
    <li><a href="query/property-index.html" title="Property Index"><span class="none"></span>Property Index</a>  </li>
    <li><a href="query/solr.html" title="Solr Index"><span class="none"></span>Solr Index</a>  </li>
      </ul>
  </li>
    <li><a href="security/overview.html" title="Security"><span class="none"></span>Security</a>  </li>
    <li><a href="features/atomic-counter.html" title="Atomic Counter"><span class="none"></span>Atomic Counter</a>  </li>
    <li><a href="features/observation.html" title="Observation"><span class="none"></span>Observation</a>  </li>
          <li class="nav-header">Using Oak</li>
    <li><a href="use_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a>  </li>
    <li><a href="construct.html" title="Repository Construction"><span class="none"></span>Repository Construction</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>Configuring Oak</a>
  </li>
    <li><a href="command_line.html" title="Command Line Tools"><span class="none"></span>Command Line Tools</a>  </li>
    <li><a href="migration.html" title="Migration"><span class="none"></span>Migration</a>  </li>
    <li><a href="differences.html" title="Differences to Jackrabbit 2"><span class="none"></span>Differences to Jackrabbit 2</a>  </li>
    <li><a href="known_issues.html" title="Known Issues"><span class="none"></span>Known Issues</a>  </li>
    <li><a href="constraints.html" title="Constraints"><span class="none"></span>Constraints</a>  </li>
    <li><a href="dos_and_donts.html" title="Dos and Don'ts"><span class="none"></span>Dos and Don'ts</a>  </li>
    <li><a href="coldstandby/coldstandby.html" title="Cold Standby"><span class="none"></span>Cold Standby</a>  </li>
    <li><a href="FAQ.html" title="FAQ"><span class="none"></span>FAQ</a>  </li>
          <li class="nav-header">Developing Oak</li>
    <li><a href="dev_getting_started.html" title="Getting Started"><span class="none"></span>Getting Started</a>  </li>
    <li><a href="participating.html" title="Participating"><span class="none"></span>Participating</a>  </li>
    <li><a href="developing-with-git.html" title="Developing with Git"><span class="none"></span>Developing with Git</a>  </li>
    <li><a href="diagnostic-builds.html" title="Cutting diagnostic builds"><span class="none"></span>Cutting diagnostic builds</a>  </li>
    <li><a href="branching.html" title="Branching off a new stable"><span class="none"></span>Branching off a new stable</a>  </li>
    <li><a href="attribution.html" title="Attribution"><span class="none"></span>Attribution</a>  </li>
    <li><a href="release-schedule.html" title="Release Schedule"><span class="none"></span>Release Schedule</a>  </li>
          <li class="nav-header">Links</li>
    <li><a href="http://jackrabbit.apache.org/oak" class="externalLink" title="Apache Jackrabbit Oak"><span class="none"></span>Apache Jackrabbit Oak</a>  </li>
    <li><a href="http://jackrabbit.apache.org/" class="externalLink" title="Apache Jackrabbit"><span class="none"></span>Apache Jackrabbit</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
          <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
        <div class="g-plusone" data-href="http://jackrabbit.apache.org/oak/docs/" data-size="tall" ></div>
                  <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
  --><h1>Repository OSGi Configuration</h1>
<p>Oak comes with a simple mechanism for constructing content repositories for use in embedded deployments and test cases. Details regarding that are provided as part of <a href="construct.html">Repository Construction</a>. When used in OSGi environment then various Oak components can be configured using OSGi Configuration Support.</p>
<p>Depending on component the configuration can be modified at runtime or needs to be specified before the initial system setup.</p>

<dl>
<dt>Static Configuration</dt>
<dd>Such configuration settings cannot be changed once a repository  is initialized. For example choosing a <tt>DataStore</tt> or specifying the path of User Home.  Such properties should not be changed once a system is initialized.</dd>
<dt>Dynamic Configuration</dt>
<dd>Some of the configuration settings like thread pool size, cache size etc can be changed  at runtime or after initial system setup</dd>
</dl>
<p>Each OSGi configuration is referred via a PID i.e. persistent identifier. Sections below provide details around various PID used in Oak</p>
<div class="section">
<div class="section">
<h3><a name="NodeStore"></a>NodeStore</h3>
<div class="section">
<h4><a name="SegmentNodeStore"></a>SegmentNodeStore</h4>
<p>This section describes the configuration for the Segment Node Store, an implementation of the Node Store that saves repository data on disk.</p>
<p>The first of these configurations, identified by <tt>org.apache.jackrabbit.oak.segment.SegmentNodeStoreService</tt>, refers to the implementation provided by the <tt>oak-segment-tar</tt> bundle. This implementation is the newest and the only actively maintained one, and should be used unless some legacy use case needs to be supported.</p>
<p>The second and last configuration, identified by <tt>org.apache.jackrabbit.oak.plugins.segment.SegmentNodeStoreService</tt>, refers to the old implementation of the Node Store provided by the <tt>oak-segment</tt> bundle. This implementation has been deprecated and removed in Oak 1.8. It will not receive any further improvements and should not be used in new projects.</p>
<div class="section">
<h5><a name="org.apache.jackrabbit.oak.segment.SegmentNodeStoreService"></a><a name="config-SegmentNodeStoreService"></a> org.apache.jackrabbit.oak.segment.SegmentNodeStoreService</h5>

<dl>
<dt>repository.home (string) - repository</dt>
<dd>A path on the file system where repository data will be stored. The Segment Store persists its data in a subdirectory of <tt>repository.home</tt> named <tt>segmentstore</tt>. The provided path can be relative or absolute. If a relative path is provided, it is handled according to the definition of relative path as specified by <tt>java.io.File</tt>. Placeholders of any kind in the path are not supported.</dd>
<dt>tarmk.mode (string) - 64</dt>
<dd>The architecture model. It can assume only two values, <tt>32</tt> or <tt>64</tt>. If this property is set to <tt>64</tt>, data files used by the Segment Store are memory-mapped. Any other value will instruct the Segment Store not to use memory-mapped files.</dd>
<dt>tarmk.size (int) - 256</dt>
<dd>The maximum size of TAR files on disk in MB.</dd>
<dt>segmentCache.size (int) - 256</dt>
<dd>The maximum size of the segment cache in MB. The segment cache keeps a subset of the segments in memory and avoids performing I/O operations when those segments are used.</dd>
<dt>stringCache.size (int) - 256</dt>
<dd>The maximum size of the strings cache in MB. The string cache keeps a subset of the string records in memory and avoids performing I/O operations when those strings are used.</dd>
<dt>templateCache.size (int) - 256</dt>
<dd>The maximum size of the template cache in MB. The template cache keeps a subset of the template records in memory and avoids performing I/O operations when those templates are used.</dd>
<dt>stringDeduplicationCache.size (int) - 15000</dt>
<dd>The maximum size of the string deduplication cache in number of items. The string deduplication cache tracks string records across different GC generations. It avoids duplicating a string record to the current GC generation if it was already duplicated in the past.</dd>
<dt>templateDeduplicationCache.size (int) - 3000</dt>
<dd>The maximum size of the template deduplication cache in number of items. The template deduplication cache tracks template records across different GC generations. It avoids duplicating a template record to the current GC generation if it was already duplicated in the past.</dd>
<dt>nodeDeduplicationCache.size (int) - 1048576</dt>
<dd>The maximum size of the node deduplication cache in number of items. The node deduplication cache tracks node records across different GC generations. It avoids duplicating a node record to the current generation if it was already duplicated in the past.</dd>
<dt>pauseCompaction (boolean) - false</dt>
<dd>Determines if online compaction should be executed. If this property is <tt>true</tt>, both the estimation and compaction phases of the online compaction process are not executed.</dd>
<dt>compaction.retryCount (int) - 5</dt>
<dd>The number of commit attempts the online compaction process should try before giving up. This property determines how many times the online compaction process should try to merge the compacted repository state with the user-generated state produced by commits executed concurrently during compaction.</dd>
<dt>compaction.force.timeout (int) - 60</dt>
<dd>The amount of time the online compaction process is allowed to exclusively lock the store, in seconds. If this property is set to a positive value, if the compaction process fails to commit the compacted state concurrently with other commits, it will acquire an exclusive lock on the Node Store. The exclusive lock prevents other commits for completion, giving the compaction process a possibility to commit the compacted state. This property determines how long the compaction process is allowed to use the Node Store in exclusive mode. If this property is set to zero or to a negative value, the compaction process will not acquire an exclusive lock on the Node Store and will just give up if too many concurrent commits are detected.</dd>
<dt>compaction.sizeDeltaEstimation (long) - 10737418240</dt>
<dd>The increase in size of the Node Store (in bytes) since the last successful compaction that will trigger another execution of the compaction phase.</dd>
<dt>compaction.disableEstimation (boolean) - false</dt>
<dd>Disables the estimation phase of the online compaction process. If this property is set to <tt>true</tt>, the estimation phase of the compaction process will never run, and compaction will always be triggered for any amount of garbage in the Node Store.</dd>
<dt>compaction.retainedGenerations (int) - 2</dt>
<dd>The number of generations to retain the Node Store. As of Oak 1.8 this option is deprecated. Its value defaults to <tt>2</tt> and cannot be changed by the user.</dd>
<dt>compaction.memoryThreshold (int) - 15</dt>
<dd>The percentage of heap memory that should always be free while compaction runs. If the available heap memory falls below the specified percentage, compaction will not be started or it will be aborted if it is already running.</dd>
<dt>compaction.progressLog (long) - -1</dt>
<dd>Enables compaction progress logging at each set of compacted nodes. A value of <tt>-1</tt> disables the log.</dd>
<dt>standby (boolean) - false</dt>
<dd>Determines if this Node Store is supposed to be used in standby mode.</dd>
<dt>customBlobStore (boolean) - false</dt>
<dd>Determines if this Node Store is supposed to use a custom Blob Store. If this property is <tt>true</tt>, a Data Store or a Blob Store needs to be configured for the Segment Store to pick it up (see below). If this property is <tt>false</tt>, binaries will be stored in the Segment Store.</dd>
<dt>repository.backup.dir (string)</dt>
<dd>The path on the file system where backups of this Node Store should be stored. It defaults to a subdirectory of <tt>repository.home</tt> named <tt>segmentstore-backup</tt>. If a relative path is provided, it is handled according to the definition of relative path as specified by <tt>java.io.File</tt>. Placeholders of any kind in the path are not supported.</dd>
</dl></div>
<div class="section">
<h5><a name="org.apache.jackrabbit.oak.plugins.segment.SegmentNodeStoreService"></a>org.apache.jackrabbit.oak.plugins.segment.SegmentNodeStoreService</h5>
<p><b>This configuration is deprecated and has been removed in Oak 1.8. It belongs to the legacy Node Store implementation provided by the oak-segment bundle. This implementation should not be used anymore. Instead, rely on the Node Store implementation provided by the oak-segment-tar bundle, whose configuration is described above.</b></p>

<dl>
<dt>repository.home (string) - tarmk</dt>
<dd>A path on the file system where repository data will be stored. The Segment Store persists its data in a subdirectory of <tt>repository.home</tt> named <tt>segmentstore</tt>. The provided path can be relative or absolute. If a relative path is provided, it is handled according to the definition of relative path as specified by <tt>java.io.File</tt>. Placeholders of any kind in the path are not supported.</dd>
<dt>tarmk.mode (string) - 64</dt>
<dd>The architecture model. It can assume only two values, <tt>32</tt> or <tt>64</tt>. If this property is set to <tt>64</tt>, data files used by the Segment Store are memory-mapped. Any other value will instruct the Segment Store not to use memory-mapped files.</dd>
<dt>tarmk.size (int) - 256</dt>
<dd>Maximum file size (in MB).</dd>
<dt>cache (int) - 256</dt>
<dd>Size of the segment cache in MB.</dd>
<dt>compaction.cloneBinaries (boolean) - false</dt>
<dd>Determines if binaries should be cloned when performing online compaction.</dd>
<dt>compaction.cleanup (string) - CLEAN_OLD</dt>
<dd>Determines how in-memory references to persisted data might influence the outcome of online compaction. It can only assume the values <tt>CLEAN_ALL</tt>, <tt>CLEAN_OLD</tt> and <tt>CLEAN_NONE</tt>. If this property is <tt>CLEAN_ALL</tt>, every memory reference is ignored. If this property is <tt>CLEAN_OLD</tt>, only memory references newer than a certain timestamp are considered (see <tt>compaction.cleanup.timestamp</tt>). If this property is <tt>CLEAN_NONE</tt>, no data pointed to by an in-memory reference will be cleaned up.</dd>
<dt>compaction.cleanup.timestamp (long) - 36000000</dt>
<dd>The expiry time for in-memory references in ms. If <tt>CLEAN_OLD</tt> is used as the value of the <tt>compaction.cleanup</tt> property, every piece of data pointed to by a reference newer than this time interval will not be considered eligible for compaction.</dd>
<dt>compaction.memoryThreshold (byte) - 5</dt>
<dd>A multiplier to help in estimating the amount of memory needed for compaction. Setting this property to <tt>0</tt> indirectly skips compaction because not enough memory is available.</dd>
<dt>compaction.gainThreshold (byte) - 10.</dt>
<dd>A percentage, expressed as an integer between <tt>0</tt> and <tt>100</tt>, representing the expected gain of online compaction. If the amount of garbage is not equals to or greater than this percentage of the total disk space occupied by the Node Store, compaction will not run. Setting this property to <tt>0</tt> or to a negative value indirectly disables the estimation phase of the online compaction process.</dd>
<dt>pauseCompaction (boolean) - true</dt>
<dd>Determines if online compaction should be executed. If this property is <tt>true</tt>, both the estimation and compaction phases of the online compaction process are not executed.</dd>
<dt>compaction.retryCount (int) - 5</dt>
<dd>The number of commit attempts the online compaction process should try before giving up. It defaults to <tt>5</tt>. This property determines how many times the online compaction process should try to merge the compacted repository state with the user-generated state produced by commits executed concurrently during compaction.</dd>
<dt>compaction.forceAfterFail (boolean) - false</dt>
<dd>Determines if online compaction should force its commit after a certain amount of attempts.</dd>
<dt>compaction.lockWaitTime (int) - 60</dt>
<dd>Determines how long (in seconds) online compaction can use the Node Store in exclusive mode. It defaults to <tt>60</tt>. This value determines the validity of the exclusive lock on the Node Store acquired by the online compaction process when forcing its commit.</dd>
<dt>persistCompactionMap (boolean) - true</dt>
<dd>Determines if the compaction map should be persisted on disk.</dd>
<dt>standby (boolean) - false</dt>
<dd>Determines if this Node Store should be started in standby mode.</dd>
<dt>secondary (boolean) - false</dt>
<dd>Determines if this Node Store should be started as a secondary store.</dd>
<dt>customBlobStore (boolean) - false</dt>
<dd>Determines if this Node Store is supposed to use a custom Blob Store. If this property is <tt>true</tt>, a Data Store or a Blob Store needs to be configured for the Segment Store to pick it up (see below). If this property is <tt>false</tt>, binaries will be stored in the Segment Store.</dd>
<dt>blobGcMaxAgeInSecs (long) - 86400</dt>
<dd>BLOB Garbage Collector (GC) logic would only consider those BLOBs for GC which are not accessed recently (currentTime - lastModifiedTime &gt; blobGcMaxAgeInSecs). For example, as per default, only those BLOBs which have been created 24 hours in the past would be considered for GC.  It is strongly advised to not set this property to a very low value of say a few minutes but only set it to a hour at a  minimum. This is to ensure that the NodeStore(s) have had the time to flush out its internal data structures to  persistence and the references to recently added blobs are accounted.</dd>
<dt>blobTrackSnapshotIntervalInSecs (long) - 43200</dt>
<dd>The blob ids cached/tracked locally are synchronized with the DataStore at this interval. Any additions and deletions will be visible to other cluster nodes or repositories connected to the shared DatStore after this. This should be less than the blobGcMaxAgeInSecs parameter above and the frequency of blob gc. See <a href="./plugins/blobstore.html#blobid-tracker">Blob tracker</a>.</dd>
</dl>
<p><a name="document-node-store"></a></p></div></div>
<div class="section">
<h4><a name="DocumentNodeStore"></a>DocumentNodeStore</h4>
<p><i>PID <tt>org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreService</tt></i></p>

<dl>
<dt>mongouri</dt>
<dd>Default - <a class="externalLink" href="mongodb://localhost:27017">mongodb://localhost:27017</a></dd>
<dd>Specifies the <a class="externalLink" href="http://docs.mongodb.org/manual/reference/connection-string/">MongoURI</a> required to connect to Mongo Database</dd>
<dt>db</dt>
<dd>Default - oak</dd>
<dd>Name of the database in Mongo</dd>
<dt>socketKeepAlive</dt>
<dd>Default - false</dd>
<dd>Enables socket keep-alive for MongoDB connections</dd>
<dd>Since 1.8.0, 1.6.2, 1.4.16</dd>
<dt>cache</dt>
<dd>Default - 256</dd>
<dd>Cache size in MB. This is distributed among various caches used in DocumentNodeStore</dd>
<dt>changesSize</dt>
<dd>Default - 256</dd>
<dd>Size in MB of capped collection used in Mongo for caching the diff output.</dd>
<dt>customBlobStore</dt>
<dd>Default false</dd>
<dd>Boolean value indicating that custom <tt>BlobStore</tt> to use. By default it uses <tt>MongoBlobStore</tt>.</dd>
<dt>maxReplicationLagInSecs</dt>
<dd>Default 21600 (6 hours)</dd>
<dd>Determines the duration beyond which it can be safely assumed that state on secondary would be consistent  with primary and its safe to read from them. (See <a class="externalLink" href="https://issues.apache.org/jira/browse/OAK-1645">OAK-1645</a>)</dd>
<dt>blobGcMaxAgeInSecs</dt>
<dd>Default 86400 (24 hrs)</dd>
<dd>Blob Garbage Collector (GC) logic would only consider those blobs for GC which are not accessed recently  (currentTime - lastModifiedTime &gt; blobGcMaxAgeInSecs). For example as per default only those blobs which have  been created 24 hrs ago would be considered for GC. It is strongly advised to not set this property to a very low  value of say a few minutes but only set it to a hour at a minimum. This is to ensure that the NodeStore(s) have had the  time to flush out its internal data structures to persistence and the references to recently added blobs are  accounted.</dd>
<dt>versionGcMaxAgeInSecs</dt>
<dd>Default 86400 (24 hrs)</dd>
<dd>Oak uses MVCC model to store the data. So each update to a node results in new version getting created. This  duration controls how much old revision data should be kept. For example if a node is deleted at time T1 then its  content would only be marked deleted at revision for T1 but its content would not be removed. Only when a Revision  GC is run then its content would removed and that too only after (currentTime -T1 &gt; versionGcMaxAgeInSecs)</dd>
<dt>versionGCExpression</dt>
<dd>Default &quot;&quot;</dd>
<dd>A cron expression that defines when the Revision GC is scheduled. If this  configuration entry is left empty, the default behaviour depends on the  <tt>documentStoreType</tt>. For <tt>MONGO</tt> the default is to schedule a run every five  seconds (also known as Continuous Revision Garbage Collection). For <tt>RDB</tt> the  default is no scheduled GC. It must be enabled explicitly with a cron  expression. E.g. the following expression triggers a GC run every night at  2 AM: <tt>0 0 2 * * ?</tt>.</dd>
<dd>Since 1.7.11</dd>
<dt>versionGCTimeLimitInSecs</dt>
<dd>Default 10800</dd>
<dd>A Revision GC run is canceled after this number of seconds. The default is  three hours.</dd>
<dd>Since 1.7.11</dd>
<dt>journalGCMaxAge</dt>
<dd>Default 86400000 (24 hrs, was 6 hrs until 1.7.4)</dd>
<dd>Journal entries older than <tt>journalGCMaxAge</tt> can be removed by the journal  garbage collector. The maximum age is specified in milliseconds.</dd>
<dd>Since 1.0.19, 1.2.3, 1.4</dd>
<dt>journalGCInterval</dt>
<dd>Default 300000 (5 min)</dd>
<dd>The interval in milliseconds with which the journal garbage collector removes  old journal entries.</dd>
<dd>Since 1.0.19, 1.2.3, 1.4</dd>
<dt>blobCacheSize</dt>
<dd>Default 16 (MB)</dd>
<dd>DocumentNodeStore when running with Mongo would use <tt>MongoBlobStore</tt> by default unless a custom <tt>BlobStore</tt> is  configured. In such scenario the size of in memory cache for the frequently used blobs can be configured via  <tt>blobCacheSize</tt>.</dd>
<dt>persistentCache</dt>
<dd>Default &#x201c;cache,binary=0&#x201d; (prior to 1.6, the persistent cache was disabled by default)</dd>
<dd>The <a href="./nodestore/persistent-cache.html">persistent cache</a>, which is stored in the local file system.</dd>
<dt><a name="cache-allocation"></a></dt>
<dt>nodeCachePercentage</dt>
<dd>Default 35 (was 25 until 1.5.14)</dd>
<dd>Percentage of <tt>cache</tt> allocated for <tt>nodeCache</tt>. See <a href="./nodestore/documentmk.html#cache">Caching</a></dd>
<dt>prevDocCachePercentage</dt>
<dd>Default 4</dd>
<dd>Percentage of <tt>cache</tt> allocated for <tt>prevDocCache</tt>. See <a href="./nodestore/documentmk.html#cache">Caching</a></dd>
<dd>Since 1.3.15</dd>
<dt>childrenCachePercentage</dt>
<dd>Default 15 (was 10 until 1.5.14)</dd>
<dd>Percentage of <tt>cache</tt> allocated for <tt>childrenCache</tt>. See <a href="./nodestore/documentmk.html#cache">Caching</a></dd>
<dt>diffCachePercentage</dt>
<dd>Default 30 (was 5 until 1.5.14)</dd>
<dd>Percentage of <tt>cache</tt> allocated for <tt>diffCache</tt>. See <a href="./nodestore/documentmk.html#cache">Caching</a></dd>
<dt>docChildrenCachePercentage</dt>
<dd>Default 3</dd>
<dd>Percentage of <tt>cache</tt> allocated for <tt>docChildrenCache</tt>. See <a href="./nodestore/documentmk.html#cache">Caching</a></dd>
<dd>Removed since 1.5.6</dd>
<dt>cacheSegmentCount</dt>
<dd>Default 16</dd>
<dd>The number of segments in the LIRS cache</dd>
<dd>Since 1.0.15, 1.2.3, 1.3.0</dd>
<dt>cacheStackMoveDistance</dt>
<dd>Default 16</dd>
<dd>The delay to move entries to the head of the queue in the LIRS cache</dd>
<dd>Since 1.0.15, 1.2.3, 1.3.0</dd>
<dt>sharedDSRepoId (From Oak 1.2.11, valid for Oak 1.2.x)</dt>
<dd>Default &quot;&quot;</dd>
<dd>Custom SharedDataStore repositoryId. Used when custom blobstore configured. Should be unique among the repositories sharing the datastore.</dd>
<dt>blobTrackSnapshotIntervalInSecs</dt>
<dd>Default 43200 (12 hrs)</dd>
<dd>The blob ids cached/tracked locally are synchronized with the DataStore at this interval. Any additions and deletions will be visible to other cluster nodes or repositories connected to the shared DatStore after this. This should be less than the blobGcMaxAgeInSecs parameter above and the frequency of blob gc. See <a href="./plugins/blobstore.html#blobid-tracker">Blob tracker</a>.</dd>
</dl>
<p>Example config file</p>

<div class="source">
<div class="source"><pre class="prettyprint">mongouri=mongodb://localhost:27017
db=oak
</pre></div></div>
<div class="section">
<h5><a name="Mongo_Configuration"></a>Mongo Configuration</h5>
<p>All the configuration related to Mongo can be specified via <a class="externalLink" href="http://docs.mongodb.org/manual/reference/connection-string/">Mongo URI</a></p>

<ul>
  
<li>
<p><b>Authentication</b> - Username and password should be specified as part of uri e.g. the following  connects and logs in to the admin database as user sysop with the password moon:</p>
  
<div class="source">
<div class="source"><pre class="prettyprint">mongodb://sysop:moon@localhost
</pre></div></div></li>
  
<li>
<p><b>Read Preferences and Write Concern</b> - These also can be spcified as part of Mongo URI. Refer to  <a href="./nodestore/documentmk.html#rw-preference">Read Preference and Write Concern</a> section for more details. For  e.g. following would set <i>readPreference</i> to <i>secondary</i> and prefer replica with tag <i>dc:ny,rack:1</i>.  It would also specify the write timeout to 10 sec</p>
  
<div class="source">
<div class="source"><pre class="prettyprint">mongodb://db1.example.net,db2.example.com?readPreference=secondary&amp;readPreferenceTags=dc:ny,rack:1&amp;readPreferenceTags=dc:ny&amp;readPreferenceTags=&amp;w=1&amp;wtimeoutMS=10000    
</pre></div></div></li>
</ul>
<p>One can also specify the connection pool size, socket timeout etc. For complete details about various possible option refer to <a class="externalLink" href="http://docs.mongodb.org/manual/reference/connection-string/">Mongo URI</a> </p>
<p><a name="config-blobstore"></a> </p></div></div></div>
<div class="section">
<h3><a name="Configuring_DataStoreBlobStore"></a>Configuring DataStore/BlobStore</h3>
<p>BlobStores are used to store the binary content. Support for Jackrabbit 2 <tt>DataStore</tt> is also provided via a <tt>DataStoreBlobStore</tt> wrapper. To use a specific BlobStore implementation following two steps need to be performed</p>

<ol style="list-style-type: decimal">
  
<li>Configure NodeStore - NodeStore config need to be modified to enable use of custom BlobStore via setting <tt>customBlobStore</tt> to true</li>
  
<li>Configure BlobStore - Create config for the required BlobStore by using the PID for that BlobStore.</li>
</ol>
<p>Refer to <a href="#config-sling">Config steps in Apache Sling</a> for an example on how to configure a <tt>FileDataStore</tt> with <tt>DocumentNodeStore</tt></p>
<div class="section">
<h4><a name="Jackrabbit_2_-_FileDataStore"></a>Jackrabbit 2 - FileDataStore</h4>
<p>Jackrabbit 2 <a class="externalLink" href="http://jackrabbit.apache.org/api/2.4/org/apache/jackrabbit/core/data/FileDataStore.html">FileDataStore</a> can be configured via following <i>pid</i></p>
<p><i>PID <tt>org.apache.jackrabbit.oak.plugins.blob.datastore.FileDataStore</tt></i></p>

<dl>
<dt>path</dt>
<dd>Default - Not specified</dd>
<dd>Path to the directory under which the files would be stored.</dd>
<dt>minRecordLength</dt>
<dd>Default - 100</dd>
<dd>Size in bytes. Binary content less than <tt>minRecordLength</tt> would be inlined i.e. the data store id is the data itself).</dd>
<dt>maxCachedBinarySize</dt>
<dd>Default - 17408 (17 KB)</dd>
<dd>Size in bytes. Binaries with size less than or equal to this size would be stored in in memory cache</dd>
<dt>cacheSizeInMB</dt>
<dd>Default - 16</dd>
<dd>Size in MB. In memory cache for storing small files whose size is less than <tt>maxCachedBinarySize</tt>. This  helps in better performance when lots of small binaries are accessed frequently.</dd>
<dt>cacheSize</dt>
<dd>Default - 0</dd>
<dd>Size in bytes of FileDataStore cache. Cache is enabled when cacheSize &gt; 0. Default is disabled.</dd>
<dt>cachePath</dt>
<dd>Default - ${home.dir}/repository/datastore</dd>
<dd>Path of local file system cache</dd>
</dl></div>
<div class="section">
<h4><a name="Jackrabbit_2_-_S3DataStore"></a>Jackrabbit 2 - S3DataStore</h4>
<p><i>PID <tt>org.apache.jackrabbit.oak.plugins.blob.datastore.S3DataStore</tt></i></p>

<dl>
<dt>maxCachedBinarySize</dt>
<dd>Default - 17408 (17 KB)</dd>
<dd>Size in bytes. Binaries with size less than or equal to this size would be stored in in memory cache</dd>
<dt>cacheSizeInMB</dt>
<dd>Default - 16</dd>
<dd>Size in MB. In memory cache for storing small files whose size is less than <tt>maxCachedBinarySize</tt>. This  helps in better performance when lots of small binaries are accessed frequently.</dd>
</dl></div>
<div class="section">
<h4><a name="Oak_-_SharedS3DataStore_Since_Oak_1.2.0"></a>Oak - SharedS3DataStore (Since Oak 1.2.0)</h4>
<p>Supports shared S3 DataStore</p>
<p><i>PID <tt>org.apache.jackrabbit.oak.plugins.blob.datastore.SharedS3DataStore</tt></i></p>

<dl>
<dt>maxCachedBinarySize</dt>
<dd>Default - 17408 (17 KB)</dd>
<dd>Size in bytes. Binaries with size less than or equal to this size would be stored in in memory cache</dd>
<dt>cacheSizeInMB</dt>
<dd>Default - 16</dd>
<dd>Size in MB. In memory cache for storing small files whose size is less than <tt>maxCachedBinarySize</tt>. This  helps in better performance when lots of small binaries are accessed frequently.</dd>
</dl></div>
<div class="section">
<h4><a name="Oak_-_AbstractSharedCachingDataStore_OAK_1.6.x"></a>Oak - AbstractSharedCachingDataStore (OAK 1.6.x)</h4>
<p>All the above data stores enable local file system caching with the following parameters</p>

<ul>
  
<li><i>PID <tt>org.apache.jackrabbit.oak.plugins.blob.datastore.SharedS3DataStore</tt></i></li>
  
<li><i>PID <tt>org.apache.jackrabbit.oak.plugins.blob.datastore.S3DataStore</tt></i></li>
  
<li><i>PID <tt>org.apache.jackrabbit.oak.plugins.blob.datastore.FileDataStore</tt></i></li>
  
<li><i>PID <tt>org.apache.jackrabbit.oak.plugins.blob.datastore.AzureDataStore</tt></i></li>
</ul>

<dl>
<dt>cacheSize</dt>
<dd>Default - 68719476736</dd>
<dd>Size in bytes of DataStore cache. Cache is disabled when cacheSize &lt;= 0.</dd>
<dt>stagingSplitPercentage</dt>
<dd>Default - 10</dd>
<dd>Percentage of cache earmarked for asynchronous upload staging. The rest would be used for caching the downloaded  files.</dd>
<dt>uploadThreads</dt>
<dd>Default - 10</dd>
<dd>The number of background threads used for asynchronous uploads.</dd>
<dt>stagingPurgeInterval</dt>
<dd>Default - 300</dd>
<dd>Interval in seconds for the background purge job to clean up uploaded entries from the upload staging cache.</dd>
<dt>stagingRetryInterval</dt>
<dd>Default - 600</dd>
<dd>Interval in seconds for the background retry job for retrying previously failed asynchronous uploads.</dd>
</dl></div></div>
<div class="section">
<h3><a name="System_properties_and_Framework_properties"></a>System properties and Framework properties</h3>
<p>Following properties are supported by Oak. They are grouped in two parts <i>Stable</i> and <i>Experimental</i>. The stable properties would be supported in future version but the experimental properties would <i>might</i> not be supported in future versions</p>
<div class="section">
<h4><a name="Stable"></a>Stable</h4>

<dl>
<dt>oak.mongo.uri</dt>
<dd>Type - System property and Framework Property</dd>
<dd>Specifies the <a class="externalLink" href="http://docs.mongodb.org/manual/reference/connection-string/">MongoURI</a> required to connect to Mongo Database</dd>
<dt>oak.mongo.db</dt>
<dd>Type - System property and Framework Property</dd>
<dd>Name of the database in Mongo</dd>
</dl></div>
<div class="section">
<h4><a name="Experimental"></a>Experimental</h4></div></div>
<div class="section">
<h3><a name="Configuration_Steps_for_Apache_Sling"></a>Configuration Steps for Apache Sling</h3>
<p>The OSGi Configuration Admin service defines a mechanism for passing configuration settings to an OSGi bundle. How a configuration is registered with the OSGi system varies depending on the application.</p>
<p><a name="config-sling"></a> For example to configure <tt>DocumentNodeStore</tt> to use <tt>FileDataStore</tt> in Apache Sling</p>

<ol style="list-style-type: decimal">
  
<li>
<p>Create a config file with name <i>org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreService.cfg</i> under <i>${sling.home}/install</i> folder with content</p>
  
<div class="source">
<div class="source"><pre class="prettyprint">#Mongo server details
mongouri=mongodb://localhost:27017

#Name of Mongo database to use
db=aem-author

#Store binaries in custom BlobStore e.g. FileDataStore
customBlobStore=true
</pre></div></div></li>
  
<li>
<p>Create a config file with name <i>org.apache.jackrabbit.oak.plugins.blob.datastore.FileDataStore.cfg</i> under  <i>${sling.home}/install</i> folder with content</p>
  
<div class="source">
<div class="source"><pre class="prettyprint">#The minimum size of an object that should be stored in this data store.
minRecordLength=4096

#path to the DataStore
path=./sling/repository/datastore

#cache for storing small binaries in-memory
cacheSizeInMB=128
</pre></div></div></li>
</ol>
<div class="section">
<h4><a name="Framework_Properties_vs_OSGi_Configuration"></a>Framework Properties vs OSGi Configuration</h4>
<p>OSGi components can read config data from two sources.</p>

<ol style="list-style-type: decimal">
  
<li>ConfigurationAdmin - These are configured via placing the *.cfg files under <i>${sling.home}/install</i> folder.  These can also be modified at runtime via Felix WebConsole typically available at <a class="externalLink" href="http://localhost:8080/system/console">http://localhost:8080/system/console</a></li>
  
<li>Framework Properties - An OSGi framework can be configured to start with some framework properties. These  properties cannot be changed at runtime. In Apache Sling these can be specified in <i>${sling.home}/sling.properties</i>  or <i>${sling.home}/conf/sling.properties</i></li>
</ol>
<p>In Oak some of the config properties are also read from <i>framework properties</i>. If a value is specified in both config file and framework properties then framework property takes precedence.</p>
<p>For example by default Sling sets <b>repository.home</b> to <i>${sling.home}/repository</i>. So this value need not be specified in config files</p></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2012&#x2013;2018
<a href="https://www.apache.org/">The Apache Software Foundation</a>.
All rights reserved.</p>
        </div>
                          <div id="ohloh" class="pull-right">
      <script type="text/javascript" src="https://www.ohloh.net/p/jackrabbit-oak/widgets/project_thin_badge.js"></script>
    </div>
        </div>
    </footer>
    </body>
</html>
